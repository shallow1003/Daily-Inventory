<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº«å­˜ç®¡ç†ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* ä»Šæ—¥è¨˜éŒ„æ¨£å¼ */
        .today-records {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .today-records.show {
            display: block;
        }

        .today-records h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .records-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        .records-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .records-table tr:last-child td {
            border-bottom: none;
        }

        .records-table tr:hover {
            background: #f8f9fa;
        }

        .no-records {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }

        .close-btn {
            float: right;
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .close-btn:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            .button-group {
                flex-direction: column;
            }

            .records-table {
                font-size: 14px;
            }

            .records-table th,
            .records-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¦ åº«å­˜ç®¡ç†ç³»çµ±</h1>

        <div class="form-group">
            <label for="itemSelect">å“é …ï¼š</label>
            <select id="itemSelect">
                <option value="">è«‹é¸æ“‡å“é …</option>
            </select>
        </div>

        <div class="form-group">
            <label for="specInput">è¦æ ¼ï¼š</label>
            <input type="text" id="specInput" disabled>
        </div>

        <div class="form-group">
            <label for="supplierInput">å» å•†ï¼š</label>
            <input type="text" id="supplierInput" disabled>
        </div>

        <div class="form-group">
            <label for="previousStockInput">å‰æ—¥åº«å­˜ï¼š</label>
            <input type="number" id="previousStockInput" disabled>
        </div>

        <div class="form-group">
            <label for="usageInput">é ˜ç”¨ï¼š</label>
            <input type="number" id="usageInput" min="0" value="0">
        </div>

        <div class="form-group">
            <label for="incomingInput">é€²è²¨ï¼š</label>
            <input type="number" id="incomingInput" min="0" value="0">
        </div>

        <div class="form-group">
            <label for="stockInput">ç•¶æ—¥åº«å­˜ï¼š</label>
            <input type="number" id="stockInput" disabled>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="submitRecord()">æ–°å¢è¨˜éŒ„</button>
            <button class="btn-secondary" onclick="sendReport()">ğŸ“¨ å¯„é€å®Œæ•´å ±è¡¨</button>
            <button class="btn-info" onclick="viewTodayRecords()">ğŸ“‹ æŸ¥çœ‹ä»Šæ—¥è¨˜éŒ„</button>
        </div>

        <div id="message"></div>

        <!-- ä»Šæ—¥è¨˜éŒ„å€åŸŸ -->
        <div id="todayRecords" class="today-records">
            <button class="close-btn" onclick="closeTodayRecords()">é—œé–‰</button>
            <h2>ğŸ“‹ ä»Šæ—¥å¡«å¯«è¨˜éŒ„</h2>
            <div id="recordsContent"></div>
        </div>
    </div>

    <script>
        // API ç¶²å€ - è«‹æ›¿æ›æˆæ‚¨çš„ Apps Script éƒ¨ç½²ç¶²å€
        const API_URL = 'YOUR_APPS_SCRIPT_URL_HERE';

        // æ‰€æœ‰ 98 å€‹å“é …çš„è³‡æ–™
        const allItems = [
            {item: "ç ‚ç³–", spec: "50", supplier: "èŠ³æº/åº·å¾‹/åœ“ç³–", initialStock: 840},
            {item: "ç´…ç³–", spec: "30", supplier: "ä¿¡èª¼", initialStock: 242},
            {item: "é»‘ç³–", spec: "25", supplier: "è€å‚³å®¶", initialStock: 263},
            {item: "å†¬ç“œå¡Š", spec: "5.8", supplier: "ä¿¡èª¼", initialStock: 160},
            {item: "éº¥èŠ½ç³–", spec: "30", supplier: "ç’°æ³°", initialStock: 45},
            {item: "æ¡‚èŠ±", spec: "1", supplier: "æ­£å¾·", initialStock: 127},
            {item: "æ´›ç¥èŠ±", spec: "24", supplier: "æ­£å¾·", initialStock: 5},
            {item: "æ¢…é†¬", spec: "18", supplier: "æ¢…çé¦™", initialStock: 0},
            {item: "ç”œæ¢…æ±", spec: "21", supplier: "æ¢…çé¦™", initialStock: 20},
            {item: "ç™½é†‹(6åº¦)", spec: "20", supplier: "åˆå°‡", initialStock: 21},
            {item: "ç™½é†‹(10åº¦)", spec: "20", supplier: "åˆå°‡", initialStock: 0},
            {item: "æ¥Šæ¡ƒæ±", spec: "20", supplier: "ç–æ—º", initialStock: 0},
            {item: "èŠ’æœæ³¥", spec: "6", supplier: "SKOT", initialStock: 159},
            {item: "è˜†è–ˆ", spec: "6", supplier: "KODAMAL", initialStock: 1031},
            {item: "å¡Šæ¤°(1*1cm)", spec: "20", supplier: "è¶Šå—", initialStock: 301},
            {item: "æ¢æ¤°", spec: "20", supplier: "è¶Šå—", initialStock: 302},
            {item: "çƒæ¢…ç²’", spec: "30", supplier: "å®å³»", initialStock: 8},
            {item: "é€²å£æ¡‚åœ“", spec: "30", supplier: "æ­£å¾·", initialStock: 16},
            {item: "å°ç£æ¡‚åœ“", spec: "30", supplier: "æå‘¨ç”˜å¹¸", initialStock: 19},
            {item: "ç«ç‘°", spec: "10", supplier: "åˆä¿¡", initialStock: 10},
            {item: "ç´…æ£—", spec: "10", supplier: "åˆä¿¡", initialStock: 11},
            {item: "å±±æ¢¨é†‡æ¶²", spec: "23å…¬æ–¤", supplier: "ç’°æ³°", initialStock: 10},
            {item: "èŠ‹é ­ç²‰", spec: "25å…¬æ–¤", supplier: "ä¸€æµ·é¦™", initialStock: 7},
            {item: "428-1", spec: "2.5Kç©ºç™½ç®±", supplier: "å¾·é¾", initialStock: 515},
            {item: "428-2", spec: "2.5Kå…­è§’", supplier: "", initialStock: 345},
            {item: "428-3", spec: "2.5KAOB", supplier: "å¾·é¾", initialStock: 1260},
            {item: "428-4", spec: "2.5Kè²é‡Œæ–¯", supplier: "å¾·é¾", initialStock: 360},
            {item: "428-6", spec: "2.5Kè© ç¿”(ç™½)", supplier: "", initialStock: 1000},
            {item: "428-7", spec: "2.5Kè© ç¿”(é»ƒ)", supplier: "å¾·é¾", initialStock: 428},
            {item: "428-9", spec: "2.5Kå¤©æ”¾", supplier: "æ­£éš†", initialStock: 770},
            {item: "440-2", spec: "5K_ç©ºç™½ç®±", supplier: "æ°¸è±é¤˜", initialStock: 2400},
            {item: "440-3", spec: "5K_AOB", supplier: "å¾·é¾", initialStock: 2040},
            {item: "440-5", spec: "5K_TOP-1", supplier: "æ­£éš†", initialStock: 560},
            {item: "440-7", spec: "BOBA", supplier: "å¾·é¾", initialStock: 450},
            {item: "430", spec: "4Kå¤§æ¹–ç®±", supplier: "", initialStock: 1400},
            {item: "430-3", spec: "4Kç©ºç™½ç®±", supplier: "æ°¸è±é¤˜", initialStock: 2000},
            {item: "430-6", spec: "4Kå¤©æ”¾", supplier: "æ­£éš†", initialStock: 1370},
            {item: "434-2", spec: "4Kå‚³ä½³å†°æ²™ç®±", supplier: "", initialStock: 320},
            {item: "434-5", spec: "4Kä¼¯æ€ç¾(ç¾è¦)", supplier: " ", initialStock: 668},
            {item: "434-5A", spec: "4Kä¼¯æ€ç¾(æ­è¦)", supplier: "å¾·é¾", initialStock: 2522},
            {item: "434-5B", spec: "4Kè© ç¿”", supplier: "å¾·é¾", initialStock: 720},
            {item: "429", spec: "å¤§æ¹–ç®±2.5åŠæœˆ", supplier: "è‹—å¼·", initialStock: 510},
            {item: "429-1", spec: "ç©ºç™½ç®±2.5åŠæœˆ", supplier: "", initialStock: 750},
            {item: "429-2", spec: "è¨±éŠ˜æ›¸2.5åŠæœˆ", supplier: "æ­£éš†", initialStock: 1340},
            {item: "432-6", spec: "905/1.8K", supplier: "æ­£éš†", initialStock: 215},
            {item: "433-1", spec: "902/1.1K", supplier: "æ­£éš†", initialStock: 570},
            {item: "446", spec: "1.6=2.1", supplier: "æ­£éš†", initialStock: 120},
            {item: "447-1", spec: "1.3K(F48)", supplier: "æ­£éš†", initialStock: 800},
            {item: "448-1", spec: "çƒ˜åŸ¹3K", supplier: "", initialStock: 411},
            {item: "461", spec: "å‚³ä½³ç®±", supplier: "å¾·é¾", initialStock: 485},
            {item: "462", spec: "éŠ“ç¶¿(åº·ç¥¥)", supplier: "", initialStock: 710},
            {item: "471", spec: "å“å®¢å¤š", supplier: "æ­£éš†", initialStock: 670},
            {item: "471-1", spec: "è¶Šå—", supplier: "æ°¸è±é¤˜", initialStock: 3194},
            {item: "476", spec: "ä¿é½¡çƒ", supplier: "æ­£éš†", initialStock: 300},
            {item: "å®‡æ½”ç®±", spec: "å®‡æ½”", supplier: "", initialStock: 360},
            {item: "æ‰¿æ©ç®±", spec: "å¤§ä¸­å’Œ", supplier: "", initialStock: 160},
            {item: "102", spec: "èŠ±ç“œ", supplier: "å°æ˜Š/é»ƒè²´", initialStock: 436},
            {item: "450", spec: "å°è‰", supplier: "å°æ˜Š/é»ƒè²´", initialStock: 960},
            {item: "RP-29", spec: "RP29ç½", supplier: "å°æ˜Š/é»ƒè²´", initialStock: 240},
            {item: "RP-123", spec: "500g", supplier: "å°æ˜Š/é»ƒè²´", initialStock: 200},
            {item: "RP-380", spec: "RP121", supplier: "å°æ˜Š/é»ƒè²´", initialStock: 300},
            {item: "12å…¥280g", spec: "æ¥Šå", supplier: "å°æ˜Š/é»ƒè²´", initialStock: 0},
            {item: "36å…¥100g", spec: "æ¥Šå", supplier: "å°æ˜Š/é»ƒè²´", initialStock: 230},
            {item: "445", spec: "å¤§æ¹–ç®±6å…¥", supplier: "è‹—å¼·", initialStock: 0},
            {item: "445-4", spec: "ç©ºç™½ç®±6å…¥", supplier: "è‹—å¼·", initialStock: 0},
            {item: "445-A", spec: "ä¹æ´²ç®±6å…¥", supplier: "è‹—å¼·", initialStock: 0},
            {item: "465", spec: "ä»™è‰ç®±6å…¥", supplier: "è‹—å¼·", initialStock: 0},
            {item: "480", spec: "401/12å…¥", supplier: "è‹—å¼·", initialStock: 0},
            {item: "480-1", spec: "401/6å…¥", supplier: "è‹—å¼·", initialStock: 0},
            {item: "20K", spec: "ä¸€ç‰ˆ180", supplier: "é‘«é¼", initialStock: 2160},
            {item: "10K", spec: "ä¸€ç‰ˆ270", supplier: "é‘«é¼", initialStock: 300},
            {item: "2.5Kç™½", spec: "39/åŒ…", supplier: "é‡‘ç›Šæ˜‡", initialStock: 160},
            {item: "5Kæœ¬", spec: "27/åŒ…", supplier: "é‡‘ç›Šæ˜‡", initialStock: 80},
            {item: "5Kç™½", spec: "27/åŒ…", supplier: "é‡‘ç›Šæ˜‡", initialStock: 46},
            {item: "2.5Kæœ¬è‰²(å¤©æ”¾)", spec: "48/åŒ…", supplier: "æ™®é£›ç‰¹", initialStock: 31},
            {item: "2.5Kç™½è‰²(å®‡æ½”)", spec: "48/åŒ…", supplier: "æ™®é£›ç‰¹", initialStock: 10},
            {item: "2.5Kç™½", spec: "48/ç®±", supplier: "æ™®é£›ç‰¹", initialStock: 240},
            {item: "2.5KLOGOç¶ ", spec: "96/ç®±", supplier: "æ™®é£›ç‰¹", initialStock: 0},
            {item: "2.5Kå“å®¢å¤š", spec: "48/ç®±", supplier: "æ™®é£›ç‰¹", initialStock: 83},
            {item: "2.5åŠæœˆç“¶", spec: "48/ç®±", supplier: "æ™®é£›ç‰¹", initialStock: 64},
            {item: "5Kæœ¬", spec: "34/åŒ…", supplier: "æ™®é£›ç‰¹", initialStock: 112},
            {item: "1.6/2.1èƒ–èƒ–ç“¶", spec: "70/ç®±", supplier: "æ™®é£›ç‰¹", initialStock: 19},
            {item: "æ‰¿æ©/å¤§ä¸­å’Œ", spec: "66/ç®±", supplier: "æ™®é£›ç‰¹", initialStock: 13},
            {item: "2.5KLOGOç™½", spec: "96/ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 63},
            {item: "2.5kLOGOç¶ ", spec: "96/ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 36},
            {item: "1.3F48(æœ¬)", spec: "100/ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 24},
            {item: "1.3F48(ç™½)", spec: "100/ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 30},
            {item: "L20(æœ¬)", spec: "96/ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 23},
            {item: "L20(ç™½)", spec: "96/ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 4},
            {item: "M11æ¨£å“ç½(å¸¸)", spec: "500/ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 6},
            {item: "M14æ¨£å“ç½(å°‘)", spec: "250/ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 7},
            {item: "F60(ç™½)", spec: "     /ç®±", supplier: "å»ºåœ‹/æ‡‹å¾—", initialStock: 4},
            {item: "3401-4.2K", spec: "24/åŒ…", supplier: "å‹ç´˜", initialStock: 400},
            {item: "369-4.5K", spec: "24/åŒ…", supplier: "å‹ç´˜", initialStock: 379},
            {item: "902-1.2K", spec: "88/åŒ…", supplier: "ä¹¾å³°", initialStock: 114},
            {item: "905-1.8K", spec: "70/åŒ…", supplier: "ä¹¾å³°", initialStock: 74},
            {item: "5KèŒ¶å¯¶", spec: "40/ç®±", supplier: "äº¬èŒ‚", initialStock: 33},
            {item: "2.5kèŒ¶å¯¶", spec: "62/ç®±", supplier: "äº¬èŒ‚", initialStock: 0}
        ];

        // åˆå§‹åŒ–
        window.onload = function() {
            populateItems();
            setupEventListeners();
        };

        // å¡«å……å“é …ä¸‹æ‹‰é¸å–®
        function populateItems() {
            const select = document.getElementById('itemSelect');
            allItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.item;
                option.textContent = item.item;
                select.appendChild(option);
            });
        }

        // è¨­å®šäº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            document.getElementById('itemSelect').addEventListener('change', onItemSelect);
            document.getElementById('usageInput').addEventListener('input', calculateStock);
            document.getElementById('incomingInput').addEventListener('input', calculateStock);
        }

        // ç•¶é¸æ“‡å“é …æ™‚
        async function onItemSelect() {
            const select = document.getElementById('itemSelect');
            const selectedItem = allItems.find(item => item.item === select.value);

            if (selectedItem) {
                document.getElementById('specInput').value = selectedItem.spec;
                document.getElementById('supplierInput').value = selectedItem.supplier;

                // ç²å–æœ€æ–°åº«å­˜
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            action: 'getLatestStock',
                            itemName: selectedItem.item
                        })
                    });

                    const result = await response.json();
                    if (result.success && result.stock !== null) {
                        document.getElementById('previousStockInput').value = result.stock;
                    } else {
                        document.getElementById('previousStockInput').value = selectedItem.initialStock;
                    }
                } catch (error) {
                    console.error('ç²å–åº«å­˜å¤±æ•—:', error);
                    document.getElementById('previousStockInput').value = selectedItem.initialStock;
                }

                document.getElementById('usageInput').value = 0;
                document.getElementById('incomingInput').value = 0;
                calculateStock();
            }
        }

        // è¨ˆç®—ç•¶æ—¥åº«å­˜
        function calculateStock() {
            const previousStock = parseFloat(document.getElementById('previousStockInput').value) || 0;
            const usage = parseFloat(document.getElementById('usageInput').value) || 0;
            const incoming = parseFloat(document.getElementById('incomingInput').value) || 0;
            const currentStock = previousStock - usage + incoming;
            document.getElementById('stockInput').value = currentStock;
        }

        // æäº¤è¨˜éŒ„
        async function submitRecord() {
            const itemName = document.getElementById('itemSelect').value;
            if (!itemName) {
                showMessage('è«‹é¸æ“‡å“é …', 'error');
                return;
            }

            const selectedItem = allItems.find(item => item.item === itemName);
            const record = {
                date: new Date().toLocaleDateString('zh-TW', {year: 'numeric', month: '2-digit', day: '2-digit'}).replace(/\//g, '/'),
                item: itemName,
                spec: selectedItem.spec,
                supplier: selectedItem.supplier,
                previousStock: parseFloat(document.getElementById('previousStockInput').value),
                usage: parseFloat(document.getElementById('usageInput').value) || 0,
                incoming: parseFloat(document.getElementById('incomingInput').value) || 0,
                stock: parseFloat(document.getElementById('stockInput').value),
                operator: 'ç³»çµ±ä½¿ç”¨è€…',
                timestamp: new Date().toLocaleString('zh-TW')
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: 'save', record: record})
                });

                const result = await response.json();
                if (result.success) {
                    showMessage('âœ… ' + result.message, 'success');
                    document.getElementById('itemSelect').value = '';
                    document.getElementById('specInput').value = '';
                    document.getElementById('supplierInput').value = '';
                    document.getElementById('previousStockInput').value = '';
                    document.getElementById('usageInput').value = 0;
                    document.getElementById('incomingInput').value = 0;
                    document.getElementById('stockInput').value = '';
                } else {
                    showMessage('âŒ ' + result.message, 'error');
                }
            } catch (error) {
                showMessage('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message, 'error');
            }
        }

        // å¯„é€å ±è¡¨
        async function sendReport() {
            if (!confirm('ç¢ºå®šè¦å¯„é€å®Œæ•´åº«å­˜å ±è¡¨åˆ° shallow1003@gmail.com å—ï¼Ÿ')) {
                return;
            }

            showMessage('â³ æ­£åœ¨ç”¢ç”Ÿå ±è¡¨ä¸¦å¯„é€ï¼Œè«‹ç¨å€™...', 'success');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: 'sendReport', operator: 'ç³»çµ±ä½¿ç”¨è€…'})
                });

                const result = await response.json();
                if (result.success) {
                    showMessage('âœ… ' + result.message, 'success');
                } else {
                    showMessage('âŒ ' + result.message, 'error');
                }
            } catch (error) {
                showMessage('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message, 'error');
            }
        }

        // æŸ¥çœ‹ä»Šæ—¥è¨˜éŒ„
        async function viewTodayRecords() {
            showMessage('â³ æ­£åœ¨è¼‰å…¥ä»Šæ—¥è¨˜éŒ„...', 'success');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({action: 'getTodayRecords'})
                });

                const result = await response.json();
                if (result.success) {
                    displayTodayRecords(result.records, result.date);
                    document.getElementById('message').innerHTML = '';
                } else {
                    showMessage('âŒ ' + result.message, 'error');
                }
            } catch (error) {
                showMessage('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message, 'error');
            }
        }

        // é¡¯ç¤ºä»Šæ—¥è¨˜éŒ„
        function displayTodayRecords(records, date) {
            const recordsDiv = document.getElementById('todayRecords');
            const contentDiv = document.getElementById('recordsContent');

            if (records.length === 0) {
                contentDiv.innerHTML = '<div class="no-records">ğŸ“ ä»Šå¤©é‚„æ²’æœ‰å¡«å¯«ä»»ä½•è¨˜éŒ„</div>';
            } else {
                let html = `
                    <p style="margin-bottom: 15px; color: #666;">
                        <strong>æ—¥æœŸï¼š${date}</strong> | å…± ${records.length} ç­†è¨˜éŒ„
                    </p>
                    <table class="records-table">
                        <thead>
                            <tr>
                                <th>å“é …</th>
                                <th>å‰æ—¥åº«å­˜</th>
                                <th>é ˜ç”¨</th>
                                <th>é€²è²¨</th>
                                <th>ç•¶æ—¥åº«å­˜</th>
                                <th>å¡«å¯«äºº</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                records.forEach(record => {
                    html += `
                        <tr>
                            <td>${record.item}</td>
                            <td>${record.previousStock}</td>
                            <td>${record.usage}</td>
                            <td>${record.incoming}</td>
                            <td><strong>${record.stock}</strong></td>
                            <td>${record.operator}</td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                contentDiv.innerHTML = html;
            }

            recordsDiv.classList.add('show');
        }

        // é—œé–‰ä»Šæ—¥è¨˜éŒ„
        function closeTodayRecords() {
            document.getElementById('todayRecords').classList.remove('show');
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = 'message ' + type;
            messageDiv.style.display = 'block';

            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
