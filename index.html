<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·šä¸Šåº«å­˜ç®¡ç†ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .content {
            padding: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            white-space: nowrap;
            color: #666;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }

        .form-group input[readonly] {
            background: #f5f5f5;
        }

        select {
            -webkit-appearance: none;
            background-color: white;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M5%206l5%205%205-5%202%201-7%207-7-7%202-1z%22%20fill%3D%22%23555%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px;
        }

        .highlight-box {
            background: #fff9e6;
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .highlight-box strong {
            color: #d4af37;
            font-size: 1.2em;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 5px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .info-box h3 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .report-section {
            background: #fff9e6;
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }

        .report-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
        }

        @media (max-width: 600px) {
            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .tab {
                font-size: 0.9em;
                padding: 10px 15px;
            }

            .btn {
                font-size: 1em;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¦ ç·šä¸Šåº«å­˜ç®¡ç†ç³»çµ±</h1>
            <p>è‡ªå‹•å¸¶å…¥å‰æ—¥åº«å­˜ | Google Sheets é›²ç«¯åŒæ­¥ | è‡ªå‹•å ±è¡¨å¯„é€</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('fill')">ğŸ“ åº«å­˜å¡«å¯«</button>
            <button class="tab" onclick="switchTab('config')">âš™ï¸ ç³»çµ±è¨­å®š</button>
        </div>

        <div class="content">
            <!-- åº«å­˜å¡«å¯«é é¢ -->
            <div id="fill-tab" class="tab-content active">
                <div class="info-box">
                    <h3>ğŸ’¡ ä½¿ç”¨æç¤º</h3>
                    <p>é¸æ“‡å“é …å¾Œï¼Œç³»çµ±æœƒè‡ªå‹•å¸¶å…¥å‰æ—¥åº«å­˜ï¼è³‡æ–™æœƒåŒæ­¥åˆ° Google Sheetsã€‚</p>
                </div>

                <form id="inventoryForm">
                    <div class="form-group">
                        <label>æ—¥æœŸ <span style="color: red;">*</span></label>
                        <input type="date" id="date" required>
                    </div>

                    <div class="form-group">
                        <label>å“é … <span style="color: red;">*</span> <span id="itemCount" style="color: #666; font-weight: normal;"></span></label>
                        <select id="item" required>
                            <option value="">-- è«‹é¸æ“‡å“é … --</option>
                        </select>
                    </div>

                    <div class="highlight-box" id="previousStockDisplay" style="display: none;">
                        <strong>å‰æ—¥åº«å­˜ï¼š<span id="previousStockValue">0</span></strong>
                    </div>

                    <div class="form-group">
                        <label>å‰æ—¥åº«å­˜</label>
                        <input type="number" id="previousStock" value="0" readonly>
                    </div>

                    <div class="form-group">
                        <label>é ˜ç”¨æ•¸é‡</label>
                        <input type="number" id="usage" value="0" min="0">
                    </div>

                    <div class="form-group">
                        <label>é€²è²¨æ•¸é‡</label>
                        <input type="number" id="incoming" value="0" min="0">
                    </div>

                    <div class="form-group">
                        <label>ç•¶æ—¥åº«å­˜ <span style="color: red;">*</span> <span style="color: #28a745; font-weight: normal;">ï¼ˆè‡ªå‹•è¨ˆç®—ï¼Œå¯ä¿®æ”¹ï¼‰</span></label>
                        <input type="number" id="stock" required min="0" placeholder="è‡ªå‹•è¨ˆç®—ï¼šå‰æ—¥åº«å­˜ - é ˜ç”¨ + é€²è²¨">
                    </div>

                    <button type="submit" class="btn btn-primary">âœ… æ–°å¢è¨˜éŒ„</button>
                </form>

                <div id="fillMessage" class="message"></div>

                <div class="report-section">
                    <h3>ğŸ“§ ä»Šæ—¥å¡«å¯«å®Œæˆäº†å—ï¼Ÿ</h3>
                    <p style="margin-bottom: 15px; color: #666;">é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œç³»çµ±æœƒè‡ªå‹•ç”¢ç”Ÿ Excel å ±è¡¨ä¸¦å¯„é€åˆ°æ‚¨çš„ Email</p>
                    <button class="btn btn-warning" onclick="sendReport()">ğŸ“¨ å¯„é€ç´¯ç©å ±è¡¨åˆ° Email</button>
                    <p style="margin-top: 15px; color: #666;">å ±è¡¨å°‡å¯„é€è‡³ï¼š<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ccbfa4ada0a0a3bbfdfcfcff8caba1ada5a0e2afa3a1">[email&#160;protected]</a></p>
                </div>
            </div>

            <!-- ç³»çµ±è¨­å®šé é¢ -->
            <div id="config-tab" class="tab-content">
                <div class="info-box">
                    <h3>âš™ï¸ Google Sheets è¨­å®š</h3>
                    <p>è«‹å®Œæˆä»¥ä¸‹è¨­å®šï¼Œè®“ç³»çµ±èƒ½å¤ åŒæ­¥è³‡æ–™åˆ° Google Sheets ä¸¦è‡ªå‹•å¯„é€å ±è¡¨ã€‚</p>
                </div>

                <div class="form-group">
                    <label>Google Apps Script ç¶²å€</label>
                    <input type="text" id="webAppUrl" placeholder="https://script.google.com/macros/s/xxxxx/exec">
                </div>

                <button class="btn btn-success" onclick="saveConfig()">ğŸ’¾ å„²å­˜è¨­å®š</button>

                <div id="configMessage" class="message"></div>

                <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“– è¨­å®šæ­¥é©Ÿ</h3>
                    <ol style="line-height: 2; color: #333;">
                        <li>å‰å¾€ <a href="https://sheets.google.com" target="_blank" style="color: #667eea;">Google Sheets</a> å»ºç«‹æ–°è©¦ç®—è¡¨</li>
                        <li>é»æ“Šã€Œæ“´å……åŠŸèƒ½ã€â†’ã€ŒApps Scriptã€</li>
                        <li>è¤‡è£½æä¾›çš„ Apps Script ç¨‹å¼ç¢¼ä¸¦è²¼ä¸Š</li>
                        <li>é»æ“Šã€Œéƒ¨ç½²ã€â†’ã€Œæ–°å¢éƒ¨ç½²ä½œæ¥­ã€â†’ã€Œç¶²é æ‡‰ç”¨ç¨‹å¼ã€</li>
                        <li>åŸ·è¡Œèº«åˆ†é¸ã€Œæˆ‘ã€ï¼Œå­˜å–æ¬Šé¸ã€Œæ‰€æœ‰äººã€</li>
                        <li>è¤‡è£½ Web App ç¶²å€ä¸¦è²¼åˆ°ä¸Šæ–¹æ¬„ä½</li>
                        <li>é»æ“Šã€Œå„²å­˜è¨­å®šã€</li>
                    </ol>
                    <p style="margin-top: 15px; color: #666;">è©³ç´°æ•™å­¸è«‹åƒè€ƒè¨­å®šæŒ‡å—æ–‡ä»¶ã€‚</p>
                </div>
            <script>
// èµ·å§‹åº«å­˜æ•¸æ“šï¼ˆ98å€‹å“é …ï¼‰
const initialStockData = [
    {
        "å“é …": "ç ‚ç³–",
        "è¦æ ¼": "50",
        "å» å•†": "èŠ³æº/åº·å¾‹/åœ“ç³–",
        "å‰æ—¥åº«å­˜": 840
    },
    {
        "å“é …": "ç´…ç³–",
        "è¦æ ¼": "30",
        "å» å•†": "ä¿¡èª¼",
        "å‰æ—¥åº«å­˜": 242
    },
    {
        "å“é …": "é»‘ç³–",
        "è¦æ ¼": "25",
        "å» å•†": "è€å‚³å®¶",
        "å‰æ—¥åº«å­˜": 263
    },
    {
        "å“é …": "å†¬ç“œå¡Š",
        "è¦æ ¼": "5.8",
        "å» å•†": "ä¿¡èª¼",
        "å‰æ—¥åº«å­˜": 160
    },
    {
        "å“é …": "éº¥èŠ½ç³–",
        "è¦æ ¼": "30",
        "å» å•†": "ç’°æ³°",
        "å‰æ—¥åº«å­˜": 45
    },
    {
        "å“é …": "æ¡‚èŠ±",
        "è¦æ ¼": "1",
        "å» å•†": "æ­£å¾·",
        "å‰æ—¥åº«å­˜": 127
    },
    {
        "å“é …": "æ´›ç¥èŠ±",
        "è¦æ ¼": "24",
        "å» å•†": "æ­£å¾·",
        "å‰æ—¥åº«å­˜": 5
    },
    {
        "å“é …": "æ¢…é†¬",
        "è¦æ ¼": "18",
        "å» å•†": "æ¢…çé¦™",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "ç”œæ¢…æ±",
        "è¦æ ¼": "21",
        "å» å•†": "æ¢…çé¦™",
        "å‰æ—¥åº«å­˜": 20
    },
    {
        "å“é …": "ç™½é†‹(6åº¦)",
        "è¦æ ¼": "20",
        "å» å•†": "åˆå°‡",
        "å‰æ—¥åº«å­˜": 21
    },
    {
        "å“é …": "ç™½é†‹(10åº¦)",
        "è¦æ ¼": "20",
        "å» å•†": "åˆå°‡",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "æ¥Šæ¡ƒæ±",
        "è¦æ ¼": "20",
        "å» å•†": "ç–æ—º",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "èŠ’æœæ³¥",
        "è¦æ ¼": "6",
        "å» å•†": "SKOT",
        "å‰æ—¥åº«å­˜": 159
    },
    {
        "å“é …": "è˜†è–ˆ",
        "è¦æ ¼": "6",
        "å» å•†": "KODAMAL",
        "å‰æ—¥åº«å­˜": 1031
    },
    {
        "å“é …": "å¡Šæ¤°(1*1cm)",
        "è¦æ ¼": "20",
        "å» å•†": "è¶Šå—",
        "å‰æ—¥åº«å­˜": 301
    },
    {
        "å“é …": "æ¢æ¤°",
        "è¦æ ¼": "20",
        "å» å•†": "è¶Šå—",
        "å‰æ—¥åº«å­˜": 302
    },
    {
        "å“é …": "çƒæ¢…ç²’",
        "è¦æ ¼": "30",
        "å» å•†": "å®å³»",
        "å‰æ—¥åº«å­˜": 8
    },
    {
        "å“é …": "é€²å£æ¡‚åœ“",
        "è¦æ ¼": "30",
        "å» å•†": "æ­£å¾·",
        "å‰æ—¥åº«å­˜": 16
    },
    {
        "å“é …": "å°ç£æ¡‚åœ“",
        "è¦æ ¼": "30",
        "å» å•†": "æå‘¨ç”˜å¹¸",
        "å‰æ—¥åº«å­˜": 19
    },
    {
        "å“é …": "ç«ç‘°",
        "è¦æ ¼": "10",
        "å» å•†": "åˆä¿¡",
        "å‰æ—¥åº«å­˜": 10
    },
    {
        "å“é …": "ç´…æ£—",
        "è¦æ ¼": "10",
        "å» å•†": "åˆä¿¡",
        "å‰æ—¥åº«å­˜": 11
    },
    {
        "å“é …": "å±±æ¢¨é†‡æ¶²",
        "è¦æ ¼": "23å…¬æ–¤",
        "å» å•†": "ç’°æ³°",
        "å‰æ—¥åº«å­˜": 10
    },
    {
        "å“é …": "èŠ‹é ­ç²‰",
        "è¦æ ¼": "25å…¬æ–¤",
        "å» å•†": "ä¸€æµ·é¦™",
        "å‰æ—¥åº«å­˜": 7
    },
    {
        "å“é …": "428-1",
        "è¦æ ¼": "2.5Kç©ºç™½ç®±",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 515
    },
    {
        "å“é …": "428-2",
        "è¦æ ¼": "2.5Kå…­è§’",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 345
    },
    {
        "å“é …": "428-3",
        "è¦æ ¼": "2.5KAOB",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 1260
    },
    {
        "å“é …": "428-4",
        "è¦æ ¼": "2.5Kè²é‡Œæ–¯",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 360
    },
    {
        "å“é …": "428-6",
        "è¦æ ¼": "2.5Kè© ç¿”(ç™½)",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 1000
    },
    {
        "å“é …": "428-7",
        "è¦æ ¼": "2.5Kè© ç¿”(é»ƒ)",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 428
    },
    {
        "å“é …": "428-9",
        "è¦æ ¼": "2.5Kå¤©æ”¾",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 770
    },
    {
        "å“é …": "440-2",
        "è¦æ ¼": "5K_ç©ºç™½ç®±",
        "å» å•†": "æ°¸è±é¤˜",
        "å‰æ—¥åº«å­˜": 2400
    },
    {
        "å“é …": "440-3",
        "è¦æ ¼": "5K_AOB",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 2040
    },
    {
        "å“é …": "440-5",
        "è¦æ ¼": "5K_TOP-1",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 560
    },
    {
        "å“é …": "440-7",
        "è¦æ ¼": "BOBA",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 450
    },
    {
        "å“é …": "430",
        "è¦æ ¼": "4Kå¤§æ¹–ç®±",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 1400
    },
    {
        "å“é …": "430-3",
        "è¦æ ¼": "4Kç©ºç™½ç®±",
        "å» å•†": "æ°¸è±é¤˜",
        "å‰æ—¥åº«å­˜": 2000
    },
    {
        "å“é …": "430-6",
        "è¦æ ¼": "4Kå¤©æ”¾",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 1370
    },
    {
        "å“é …": "434-2",
        "è¦æ ¼": "4Kå‚³ä½³å†°æ²™ç®±",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 320
    },
    {
        "å“é …": "434-5",
        "è¦æ ¼": "4Kä¼¯æ€ç¾(ç¾è¦)",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 668
    },
    {
        "å“é …": "434-5A",
        "è¦æ ¼": "4Kä¼¯æ€ç¾(æ­è¦)",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 2522
    },
    {
        "å“é …": "434-5B",
        "è¦æ ¼": "4Kè© ç¿”",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 720
    },
    {
        "å“é …": "429",
        "è¦æ ¼": "å¤§æ¹–ç®±2.5åŠæœˆ",
        "å» å•†": "è‹—å¼·",
        "å‰æ—¥åº«å­˜": 510
    },
    {
        "å“é …": "429-1",
        "è¦æ ¼": "ç©ºç™½ç®±2.5åŠæœˆ",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 750
    },
    {
        "å“é …": "429-2",
        "è¦æ ¼": "è¨±éŠ˜æ›¸2.5åŠæœˆ",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 1340
    },
    {
        "å“é …": "432-6",
        "è¦æ ¼": "905/1.8K",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 215
    },
    {
        "å“é …": "433-1",
        "è¦æ ¼": "902/1.1K",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 570
    },
    {
        "å“é …": "446",
        "è¦æ ¼": "1.6=2.1",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 120
    },
    {
        "å“é …": "447-1",
        "è¦æ ¼": "1.3K(F48)",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 800
    },
    {
        "å“é …": "448-1",
        "è¦æ ¼": "çƒ˜åŸ¹3K",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 411
    },
    {
        "å“é …": "461",
        "è¦æ ¼": "å‚³ä½³ç®±",
        "å» å•†": "å¾·é¾",
        "å‰æ—¥åº«å­˜": 485
    },
    {
        "å“é …": "462",
        "è¦æ ¼": "éŠ“ç¶¿(åº·ç¥¥)",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 710
    },
    {
        "å“é …": "471",
        "è¦æ ¼": "å“å®¢å¤š",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 670
    },
    {
        "å“é …": "471-1",
        "è¦æ ¼": "è¶Šå—",
        "å» å•†": "æ°¸è±é¤˜",
        "å‰æ—¥åº«å­˜": 3194
    },
    {
        "å“é …": "476",
        "è¦æ ¼": "ä¿é½¡çƒ",
        "å» å•†": "æ­£éš†",
        "å‰æ—¥åº«å­˜": 300
    },
    {
        "å“é …": "å®‡æ½”ç®±",
        "è¦æ ¼": "å®‡æ½”",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 360
    },
    {
        "å“é …": "æ‰¿æ©ç®±",
        "è¦æ ¼": "å¤§ä¸­å’Œ",
        "å» å•†": "",
        "å‰æ—¥åº«å­˜": 160
    },
    {
        "å“é …": "102",
        "è¦æ ¼": "èŠ±ç“œ",
        "å» å•†": "å°æ˜Š/é»ƒè²´",
        "å‰æ—¥åº«å­˜": 436
    },
    {
        "å“é …": "450",
        "è¦æ ¼": "å°è‰",
        "å» å•†": "å°æ˜Š/é»ƒè²´",
        "å‰æ—¥åº«å­˜": 960
    },
    {
        "å“é …": "RP-29",
        "è¦æ ¼": "RP29ç½",
        "å» å•†": "å°æ˜Š/é»ƒè²´",
        "å‰æ—¥åº«å­˜": 240
    },
    {
        "å“é …": "RP-123",
        "è¦æ ¼": "500g",
        "å» å•†": "å°æ˜Š/é»ƒè²´",
        "å‰æ—¥åº«å­˜": 200
    },
    {
        "å“é …": "RP-380",
        "è¦æ ¼": "RP121",
        "å» å•†": "å°æ˜Š/é»ƒè²´",
        "å‰æ—¥åº«å­˜": 300
    },
    {
        "å“é …": "12å…¥280g",
        "è¦æ ¼": "æ¥Šå",
        "å» å•†": "å°æ˜Š/é»ƒè²´",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "36å…¥100g",
        "è¦æ ¼": "æ¥Šå",
        "å» å•†": "å°æ˜Š/é»ƒè²´",
        "å‰æ—¥åº«å­˜": 230
    },
    {
        "å“é …": "445",
        "è¦æ ¼": "å¤§æ¹–ç®±6å…¥",
        "å» å•†": "è‹—å¼·",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "445-4",
        "è¦æ ¼": "ç©ºç™½ç®±6å…¥",
        "å» å•†": "è‹—å¼·",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "445-A",
        "è¦æ ¼": "ä¹æ´²ç®±6å…¥",
        "å» å•†": "è‹—å¼·",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "465",
        "è¦æ ¼": "ä»™è‰ç®±6å…¥",
        "å» å•†": "è‹—å¼·",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "480",
        "è¦æ ¼": "401/12å…¥",
        "å» å•†": "è‹—å¼·",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "480-1",
        "è¦æ ¼": "401/6å…¥",
        "å» å•†": "è‹—å¼·",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "20K",
        "è¦æ ¼": "ä¸€ç‰ˆ180",
        "å» å•†": "é‘«é¼",
        "å‰æ—¥åº«å­˜": 2160
    },
    {
        "å“é …": "10K",
        "è¦æ ¼": "ä¸€ç‰ˆ270",
        "å» å•†": "é‘«é¼",
        "å‰æ—¥åº«å­˜": 300
    },
    {
        "å“é …": "2.5Kç™½",
        "è¦æ ¼": "39/åŒ…",
        "å» å•†": "é‡‘ç›Šæ˜‡",
        "å‰æ—¥åº«å­˜": 160
    },
    {
        "å“é …": "5Kæœ¬",
        "è¦æ ¼": "27/åŒ…",
        "å» å•†": "é‡‘ç›Šæ˜‡",
        "å‰æ—¥åº«å­˜": 80
    },
    {
        "å“é …": "5Kç™½",
        "è¦æ ¼": "27/åŒ…",
        "å» å•†": "é‡‘ç›Šæ˜‡",
        "å‰æ—¥åº«å­˜": 46
    },
    {
        "å“é …": "2.5Kæœ¬è‰²(å¤©æ”¾)",
        "è¦æ ¼": "48/åŒ…",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 31
    },
    {
        "å“é …": "2.5Kç™½è‰²(å®‡æ½”)",
        "è¦æ ¼": "48/åŒ…",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 10
    },
    {
        "å“é …": "2.5Kç™½",
        "è¦æ ¼": "48/ç®±",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 240
    },
    {
        "å“é …": "2.5KLOGOç¶ ",
        "è¦æ ¼": "96/ç®±",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 0
    },
    {
        "å“é …": "2.5Kå“å®¢å¤š",
        "è¦æ ¼": "48/ç®±",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 83
    },
    {
        "å“é …": "2.5åŠæœˆç“¶",
        "è¦æ ¼": "48/ç®±",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 64
    },
    {
        "å“é …": "5Kæœ¬",
        "è¦æ ¼": "34/åŒ…",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 112
    },
    {
        "å“é …": "1.6/2.1èƒ–èƒ–ç“¶",
        "è¦æ ¼": "70/ç®±",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 19
    },
    {
        "å“é …": "æ‰¿æ©/å¤§ä¸­å’Œ",
        "è¦æ ¼": "66/ç®±",
        "å» å•†": "æ™®é£›ç‰¹",
        "å‰æ—¥åº«å­˜": 13
    },
    {
        "å“é …": "2.5KLOGOç™½",
        "è¦æ ¼": "96/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 63
    },
    {
        "å“é …": "2.5kLOGOç¶ ",
        "è¦æ ¼": "96/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 36
    },
    {
        "å“é …": "1.3F48(æœ¬)",
        "è¦æ ¼": "100/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 24
    },
    {
        "å“é …": "1.3F48(ç™½)",
        "è¦æ ¼": "100/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 30
    },
    {
        "å“é …": "L20(æœ¬)",
        "è¦æ ¼": "96/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 23
    },
    {
        "å“é …": "L20(ç™½)",
        "è¦æ ¼": "96/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 4
    },
    {
        "å“é …": "M11æ¨£å“ç½(å¸¸)",
        "è¦æ ¼": "500/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 6
    },
    {
        "å“é …": "M14æ¨£å“ç½(å°‘)",
        "è¦æ ¼": "250/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 7
    },
    {
        "å“é …": "F60(ç™½)",
        "è¦æ ¼": "/ç®±",
        "å» å•†": "å»ºåœ‹/æ‡‹å¾—",
        "å‰æ—¥åº«å­˜": 4
    },
    {
        "å“é …": "3401-4.2K",
        "è¦æ ¼": "24/åŒ…",
        "å» å•†": "å‹ç´˜",
        "å‰æ—¥åº«å­˜": 400
    },
    {
        "å“é …": "369-4.5K",
        "è¦æ ¼": "24/åŒ…",
        "å» å•†": "å‹ç´˜",
        "å‰æ—¥åº«å­˜": 379
    },
    {
        "å“é …": "902-1.2K",
        "è¦æ ¼": "88/åŒ…",
        "å» å•†": "ä¹¾å³°",
        "å‰æ—¥åº«å­˜": 114
    },
    {
        "å“é …": "905-1.8K",
        "è¦æ ¼": "70/åŒ…",
        "å» å•†": "ä¹¾å³°",
        "å‰æ—¥åº«å­˜": 74
    },
    {
        "å“é …": "5KèŒ¶å¯¶",
        "è¦æ ¼": "40/ç®±",
        "å» å•†": "äº¬èŒ‚",
        "å‰æ—¥åº«å­˜": 33
    },
    {
        "å“é …": "2.5kèŒ¶å¯¶",
        "è¦æ ¼": "62/ç®±",
        "å» å•†": "äº¬èŒ‚",
        "å‰æ—¥åº«å­˜": 0
    }
];

console.log('å“é …è³‡æ–™å·²è¼‰å…¥:', initialStockData.length, 'å€‹å“é …');


// Google Apps Script Web App URL
let WEB_APP_URL = localStorage.getItem('webAppUrl') || '';

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // è¨­å®šä»Šå¤©æ—¥æœŸ
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').value = today;

    // è¼‰å…¥å“é …
    loadItems();

    // åˆå§‹åŒ– localStorage
    if (!localStorage.getItem('inventoryRecords')) {
        localStorage.setItem('inventoryRecords', JSON.stringify([]));
    }

    // é¡¯ç¤ºå·²å„²å­˜çš„è¨­å®š
    if (WEB_APP_URL) {
        document.getElementById('webAppUrl').value = WEB_APP_URL;
    }

    // ç¶å®šå“é …é¸æ“‡äº‹ä»¶
    document.getElementById('item').addEventListener('change', updatePreviousStock);

    // ç¶å®šé ˜ç”¨å’Œé€²è²¨æ•¸é‡è®Šæ›´äº‹ä»¶ï¼Œè‡ªå‹•è¨ˆç®—ç•¶æ—¥åº«å­˜
    document.getElementById('usage').addEventListener('input', autoCalculateStock);
    document.getElementById('incoming').addEventListener('input', autoCalculateStock);

    // ç¶å®šè¡¨å–®æäº¤äº‹ä»¶
    document.getElementById('inventoryForm').addEventListener('submit', submitForm);
});

// è¼‰å…¥å“é …åˆ°ä¸‹æ‹‰é¸å–®
function loadItems() {
    const select = document.getElementById('item');
    
    initialStockData.forEach(item => {
        const option = document.createElement('option');
        option.value = item.å“é …;
        option.textContent = `${item.å“é …} (${item.è¦æ ¼}) - ${item.å» å•†}`;
        option.dataset.spec = item.è¦æ ¼;
        option.dataset.supplier = item.å» å•†;
        option.dataset.initialStock = item.å‰æ—¥åº«å­˜;
        select.appendChild(option);
    });

    document.getElementById('itemCount').textContent = `(å…± ${initialStockData.length} å€‹å“é …)`;
}

// æ›´æ–°å‰æ—¥åº«å­˜
function updatePreviousStock() {
    const select = document.getElementById('item');
    const selectedValue = select.value;
    
    if (!selectedValue) {
        document.getElementById('previousStockDisplay').style.display = 'none';
        document.getElementById('previousStock').value = 0;
        document.getElementById('stock').value = '';
        return;
    }

    const date = document.getElementById('date').value;
    const previousStock = getPreviousStock(selectedValue, date);
    
    document.getElementById('previousStock').value = previousStock;
    document.getElementById('previousStockValue').textContent = previousStock;
    document.getElementById('previousStockDisplay').style.display = 'block';
    
    // é¸æ“‡å“é …å¾Œï¼Œè‡ªå‹•è¨ˆç®—ä¸€æ¬¡ç•¶æ—¥åº«å­˜
    autoCalculateStock();
}

// è‡ªå‹•è¨ˆç®—ç•¶æ—¥åº«å­˜
function autoCalculateStock() {
    const previousStock = parseInt(document.getElementById('previousStock').value) || 0;
    const usage = parseInt(document.getElementById('usage').value) || 0;
    const incoming = parseInt(document.getElementById('incoming').value) || 0;
    
    // å¦‚æœå‰æ—¥åº«å­˜ç‚º 0ï¼ˆé‚„æ²’é¸å“é …ï¼‰ï¼Œå‰‡ä¸è¨ˆç®—
    if (previousStock === 0 && !document.getElementById('item').value) {
        return;
    }
    
    // è¨ˆç®—ï¼šå‰æ—¥åº«å­˜ - é ˜ç”¨ + é€²è²¨ = ç•¶æ—¥åº«å­˜
    const calculatedStock = previousStock - usage + incoming;
    
    // è‡ªå‹•å¡«å…¥ç•¶æ—¥åº«å­˜æ¬„ä½
    document.getElementById('stock').value = calculatedStock;
}

// å–å¾—å‰æ—¥åº«å­˜
function getPreviousStock(itemName, currentDate) {
    const records = JSON.parse(localStorage.getItem('inventoryRecords') || '[]');
    
    // æ‰¾å‡ºè©²å“é …åœ¨ç•¶å‰æ—¥æœŸä¹‹å‰çš„æœ€æ–°è¨˜éŒ„
    const itemRecords = records
        .filter(r => r.item === itemName && r.date < currentDate)
        .sort((a, b) => b.date.localeCompare(a.date));
    
    if (itemRecords.length > 0) {
        return itemRecords[0].stock;
    }
    
    // æ²’æœ‰æ­·å²è¨˜éŒ„ï¼Œä½¿ç”¨åˆå§‹åº«å­˜
    const initialItem = initialStockData.find(item => item.å“é … === itemName);
    return initialItem ? initialItem.å‰æ—¥åº«å­˜ : 0;
}

// æäº¤è¡¨å–®
function submitForm(e) {
    e.preventDefault();
    
    const select = document.getElementById('item');
    const selectedOption = select.options[select.selectedIndex];
    
    const record = {
        id: Date.now(),
        date: document.getElementById('date').value,
        item: select.value,
        spec: selectedOption.dataset.spec || '',
        supplier: selectedOption.dataset.supplier || '',
        previousStock: parseInt(document.getElementById('previousStock').value) || 0,
        usage: parseInt(document.getElementById('usage').value) || 0,
        incoming: parseInt(document.getElementById('incoming').value) || 0,
        stock: parseInt(document.getElementById('stock').value) || 0,
        operator: 'ç³»çµ±',
        timestamp: new Date().toLocaleString('zh-TW')
    };

    // å…ˆå„²å­˜åˆ°æœ¬åœ°
    const records = JSON.parse(localStorage.getItem('inventoryRecords') || '[]');
    records.push(record);
    localStorage.setItem('inventoryRecords', JSON.stringify(records));

    // åŒæ­¥åˆ° Google Sheets
    if (WEB_APP_URL) {
        syncToGoogleSheets(record);
    } else {
        showMessage('fillMessage', 'âœ… è¨˜éŒ„å·²æ–°å¢ï¼ˆæœ¬åœ°å„²å­˜ï¼‰\nâš ï¸ å°šæœªè¨­å®š Google Sheetsï¼Œè³‡æ–™åƒ…å„²å­˜åœ¨æœ¬æ©Ÿ', 'success');
    }

    // æ¸…ç©ºéƒ¨åˆ†è¡¨å–®
    document.getElementById('item').value = '';
    document.getElementById('usage').value = 0;
    document.getElementById('incoming').value = 0;
    document.getElementById('stock').value = '';
    document.getElementById('previousStockDisplay').style.display = 'none';
}

// åŒæ­¥åˆ° Google Sheets
async function syncToGoogleSheets(record) {
    try {
        showMessage('fillMessage', 'â³ æ­£åœ¨åŒæ­¥åˆ° Google Sheets...', 'success');

        const response = await fetch(WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                action: 'save',
                record: record
            })
        });

        showMessage('fillMessage', 'âœ… è¨˜éŒ„å·²æˆåŠŸæ–°å¢ä¸¦åŒæ­¥åˆ° Google Sheetsï¼', 'success');

    } catch (error) {
        console.error('åŒæ­¥å¤±æ•—:', error);
        showMessage('fillMessage', 'âœ… è¨˜éŒ„å·²æ–°å¢ï¼ˆæœ¬åœ°å„²å­˜ï¼‰\nâš ï¸ Google Sheets åŒæ­¥å¤±æ•—ï¼Œä½†è³‡æ–™å·²å„²å­˜åœ¨æœ¬æ©Ÿ', 'success');
    }
}

// å¯„é€å ±è¡¨
async function sendReport() {
    if (!WEB_APP_URL) {
        showMessage('fillMessage', 'âŒ è«‹å…ˆåœ¨ã€Œç³»çµ±è¨­å®šã€ä¸­è¨­å®š Google Apps Script ç¶²å€', 'error');
        return;
    }

    const operator = 'ç³»çµ±';
    
    if (!confirm('ç¢ºå®šè¦å¯„é€ç´¯ç©å ±è¡¨åˆ° shallow1003@gmail.com å—ï¼Ÿ')) {
        return;
    }

    try {
        showMessage('fillMessage', 'â³ æ­£åœ¨ç”¢ç”Ÿå ±è¡¨ä¸¦å¯„é€ä¸­ï¼Œè«‹ç¨å€™...', 'success');

        const response = await fetch(WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                action: 'sendReport',
                operator: operator
            })
        });

        // å› ç‚ºä½¿ç”¨ no-corsï¼Œç„¡æ³•è®€å–å¯¦éš›å›æ‡‰
        // å‡è¨­æˆåŠŸï¼ˆå¯¦éš›æ‡‰è©²è¦æœ‰å…¶ä»–é©—è­‰æ©Ÿåˆ¶ï¼‰
        setTimeout(() => {
            showMessage('fillMessage', 'âœ… å ±è¡¨å·²æˆåŠŸå¯„é€åˆ° shallow1003@gmail.comï¼\nè«‹ç¨å¾Œæª¢æŸ¥æ‚¨çš„ä¿¡ç®±ï¼ˆå¯èƒ½åœ¨åƒåœ¾éƒµä»¶ä¸­ï¼‰', 'success');
        }, 2000);

    } catch (error) {
        console.error('å¯„é€å¤±æ•—:', error);
        showMessage('fillMessage', 'âŒ å ±è¡¨å¯„é€å¤±æ•—ï¼š' + error.message, 'error');
    }
}

// å„²å­˜è¨­å®š
function saveConfig() {
    const url = document.getElementById('webAppUrl').value.trim();
    
    if (!url) {
        showMessage('configMessage', 'âŒ è«‹è¼¸å…¥ Google Apps Script ç¶²å€', 'error');
        return;
    }

    if (!url.includes('script.google.com')) {
        showMessage('configMessage', 'âŒ ç¶²å€æ ¼å¼ä¸æ­£ç¢ºï¼Œæ‡‰è©²åŒ…å« script.google.com', 'error');
        return;
    }

    localStorage.setItem('webAppUrl', url);
    WEB_APP_URL = url;
    
    showMessage('configMessage', 'âœ… è¨­å®šå·²å„²å­˜ï¼ç¾åœ¨å¯ä»¥é–‹å§‹ä½¿ç”¨ Google Sheets åŒæ­¥åŠŸèƒ½ã€‚', 'success');
}

// åˆ‡æ›åˆ†é 
function switchTab(tabName) {
    // ç§»é™¤æ‰€æœ‰ active
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

    // åŠ ä¸Šç•¶å‰çš„ active
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        if (tab.textContent.includes(tabName === 'fill' ? 'åº«å­˜å¡«å¯«' : 'ç³»çµ±è¨­å®š')) {
            tab.classList.add('active');
        }
    });

    document.getElementById(`${tabName}-tab`).classList.add('active');
}

// é¡¯ç¤ºè¨Šæ¯
function showMessage(elementId, message, type) {
    const messageDiv = document.getElementById(elementId);
    messageDiv.textContent = message;
    messageDiv.className = `message ${type}`;
    messageDiv.style.whiteSpace = 'pre-line';
    
    if (type !== 'error') {
        setTimeout(() => {
            messageDiv.className = 'message';
        }, 5000);
    }
}

    </script>
 